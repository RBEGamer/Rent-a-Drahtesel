<% layout(layoutPath + 'layout') -%>

<div class="row no-gutters">
	<div class="col-12">
		<div class="d-flex flex-column flex-md-row">
			<% if(userdata.picture != undefined){ %> <img
				class="img-responsive bild margin"
				src="/uploads/<%= userdata.picture.toString('utf8') %>" alt=""> <%
			}else{ %> <img class="img-responsive bild margin"
				src="/images/leer.png" alt=""> <% } %>
			<div class="white margin padding">
				<% if(isLoggedIn){ %>
                <div>
                    <h1 class="d-none d-md-block display-4"><%= userdata.Vorname %> <%= userdata.Name %></h1>
                </div>
                <div>
                    <h1 class="d-block d-md-none"><%= userdata.Vorname %> <%= userdata.Name %></h1>
                </div>
				
				<% }else { %>
				<h1 class="display-4"><%= userdata.Vorname.charAt(0) %>.
					<%=userdata.Name %></h1>
				<% } %>
				<% if(isLoggedIn){ %>
            				<button id="start">
                        		<div class="starRating" size="40" starMax="5" value="<%= userdata.Rating %>" mode="show" fillColor="yellow" emptyColor="grey"></div>
            				</button>
    					<% }else{ %>
    						<div class="starRating" size="40" starMax="5" value="<%= userdata.Rating %>" mode="show" fillColor="yellow" emptyColor="grey"></div>
    					<% } %>

				<% if(isLoggedIn){  %>
					E-Mail: <%= userdata.email %>
				<% if(userdata.phone != null){  %>
					<br/>Telefon: <%= userdata.phone %>
				<% }} %>
			</div>
		</div>
	</div>
</div>

 	<div id="popup" class="overlayHidden">
		<form method="post" action="rate">
			<h1>Bewertung</h1>
			<input name="pk_id" type="hidden" value='<%= userdata.pk_ID %>'>
			<textarea required name="bewertungstext" rows="10" cols="170" placeholder="Bitte hinterlassen Sie einen kurzen Kommentar."></textarea>
			<label>Bewertung: </label>
			<input required name="bewertungsnr" type="number" min="1" max="5" step="0.5" value="5">
	 		<input id="bewerten" type="submit" class="btn btn-secondary btn-block height" value="Bewerten"/>
		</form>
	 		<input id="schliessen" type="submit" class="btn btn-secondary btn-block height" value="Abbrechen"/>
	</div>

<% if(isLoggedIn){%>

        <div class="margin height">
            <div class="row no-gutters">
                <div class="col-4 col-md-5"><hr style="width: 100%; color: grey; height: 1px; background-color:grey;" /></div>
                <div class="col-4 col-md-2"><p class="text-center" style="color: grey;">Standort</p></div>
                <div class="col-4 col-md-5"><hr style="width: 100%; color: grey; height: 1px; background-color:grey;" /></div>
            </div>
        </div>

<div class="row no-gutters">

	<div class="col-12">
		<div class="margin">
			<div id="map" style="width: 100%; height: 200px;"></div>
		</div>
		<div class="margin middle">
			<span>Standort: <%= userdata.street %> <%= userdata.housenumber %>,
				<%= userdata.zip %> <%= userdata.city %></span>
		</div>
	</div>
</div>



<% } %>

        <div class="margin height">
            <div class="row no-gutters">
                <div class="col-3 col-md-4"><hr style="width: 100%; color: grey; height: 1px; background-color:grey;" /></div>
                <div class="col-6 col-md-4"><p class="text-center" style="color: grey;">Bewertungen</p></div>
                <div class="col-3 col-md-4"><hr style="width: 100%; color: grey; height: 1px; background-color:grey;" /></div>
            </div>
        </div>

<div class="row no-gutters">

     	<% if(ratings.length === 0){ %>
     		<p>Es sind noch keine Bewertungen vorhanden.</p>
     	<% } %>
	<% if(ratings!= undefined){ %> <% ratings.forEach(function(n) { %>
	<div class="col-12">
		<div class="white margin">
			<div class="padding linie-unten">
				<span> <% if(n.picture == undefined || n.picture == ""){ %> <img
					src="/images/leer.png" alt="" height="25"> <% }else{ %> <img
					src="<%= n.picture %>" alt="" height="25"> <% } %> <strong>&nbsp;<a
						href="/profile/<%= n.pk_ID %>"><%= n.ratername %></a>&emsp;
				</strong>
					<div class="starRating" size="20" starMax="5"
						value="<%= n.Rating %>" mode="show" fillColor="yellow"
						emptyColor="grey"></div>
				</span>
			</div>
			<div class="padding">
				<span><%= n.Description %></span>
			</div>
		</div>
	</div>
	<% }); %> <% } %>
</div>




<script>                      
        // center: new google.maps.LatLng(<%= maps_key %>, <%= userdata.lon %>),
        function initMap() {
         var uluru = {lat: <%= userdata.lat %>, lng: <%= userdata.lon %>};
         var map = new google.maps.Map(document.getElementById('map'), {
           zoom: 15,
           center: uluru
         });
         var marker = new google.maps.Marker({
           position: uluru,
           map: map
         });
       }
       
       
        var startBtn = document.getElementById('start'),
        BewertungBtn = document.getElementById('bewerten'),
        SchliessenBtn = document.getElementById('schliessen');
        var popup = document.getElementById('popup');
		if(popup != null){
	        startBtn.addEventListener('click',zeigeFenster);
	        BewertungBtn.addEventListener('click',schliesseFenster);
	        SchliessenBtn.addEventListener('click',schliesseFenster);
		}

        function zeigeFenster() { 
            popup.className = 'overlay';
        }

        function schliesseFenster(){
            popup.className = 'overlayHidden';
        }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= maps_key %>&callback=initMap"></script>

