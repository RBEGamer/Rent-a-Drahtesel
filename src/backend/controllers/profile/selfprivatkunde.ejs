<% layout(layoutPath + 'layout') -%>

<head>
<style>
.tabcontent {
	animation: fadeEffect 1s; /* Fading effect takes 1 second */
}

/* Go from zero to full opacity */
@
keyframes fadeEffect {
	from {opacity: 0;
}

to {
	opacity: 1;
}
}
</style>
</head>


<script>
	function get_own_table(_divid, _data) {
		if (_data == undefined || _data == null || _data == "") {
			return;
		}
		var dt = _data.split(',');
		if(dt.lenght <= 0){return;}



		var dts = "";

		for (var j = 0; j < dt.length; j++) {
			dts += " "+ dt[j]+" ";
		}

		var table = "<table>";
		//for (var j = 0; j < dt.length; j++) {
			var dtd = new Date(dt[0]);
			var dtd = new Date(dt[dt.lenght-1]);
			table += "<tr><td>< href='#' title='"+dts+"' >" + dtd.getDay() + "." + (dtd.getMonth() + 1)
					+ "." + dtd.getFullYear() + " - " + dtd1.getDay() + "." + (dtd1.getMonth() + 1)
					+ "." + dtd1.getFullYear() + "</a></td></tr>";
		//}
		table += "</table>";
		document.getElementById(_divid).innerHTML = table;
	}
</script>



<div class="row no-gutters">
	<div class="col-12">
		<div class="d-flex flex-column flex-md-row">
			<% if(userdata.picture != undefined){ %> <img
				class="img-responsive bild margin"
				src="<%= userdata.picture.toString('utf8') %>" alt=""> <%
			}else{ %> <img class="img-responsive bild margin"
				src="/images/leer.png" alt=""> <% } %>
			<div class="white margin padding">
				<h1 class="display-4"><%= userdata.Vorname %> <%= userdata.Name
					%></h1>
				<div class="starRating" starMax="5" value="<%= own_rating.Rating %>"
					fillColor="#ffef19" emptyColor="#e8e7e3" mode="show" size="40"></div>
				<div class="row">
					<div class="col-9">
						<span>E-mail: <%= userdata.email %></span><br /> <%
						if(userdata.phone != undefined){ %> <span>Telefon: <%=
							userdata.phone %></span> <% } %>
					</div>
					<div class="col-3">
						<div class="margin height">
							<form action="/editprofile" method="get">
								<input type="submit" class="btn btn-secondary btn-block height"
									value="Profil bearbeiten" />
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>



<div class="row">
	<div class="col-5 col-md">
		<hr
			style="width: 100%; color: black; height: 1px; background-color: black;" />
	</div>
	<div class="col-2 col-md">
		<p class="text-center">Standort</p>
	</div>
	<div class="col-5 col-md">
		<hr
			style="width: 100%; color: black; height: 1px; background-color: black;" />
	</div>
</div>

<div class="row no-gutters">

	<div class="col-12">
		<div class="margin">
			<div id="map" style="width: 100%; height: 200px;"></div>
		</div>
		<div class="margin middle">
			<span>Standort: <%= userdata.street %> <%=
				userdata.housenumber %>, <%= userdata.zip %> <%= userdata.city %></span>
		</div>
	</div>
</div>

<div class="row">
	<div class="col-5 col-md">
		<hr
			style="width: 100%; color: black; height: 1px; background-color: black;" />
	</div>
	<div class="col-2 col-md">
		<p class="text-center">Bestellungen</p>
	</div>
	<div class="col-5 col-md">
		<hr
			style="width: 100%; color: black; height: 1px; background-color: black;" />
	</div>
</div>

<div class="container grey">
	<ul class="nav nav-tabs">
		<li class="nav-link active"><a id="def" data-toggle="tab" href="#fahrraeder">
				Meine Fahrr&auml;der
		</a></li>
		<li class="nav-link"><a data-toggle="tab" href="#bestellungen">
				Meine Bestellungen
		</a></li>
	</ul>

	<div class="tab-content">
		<div id="fahrraeder" class="tab-pane fade in active">
			<div class="row no-gutters">
				<% var counter = 0; %> <% if(bikes!= undefined){ %> <%
				bikes.forEach(function(m) { %>
				<div class="col-12">
					<div class="white margin">
						<div class="padding linie-unten">
							<span> <strong><%= m.Name %>&emsp;</strong>
								<div class="starRating" starMax="5" value="6"
									fillColor="#ffef19" emptyColor="#e8e7e3" mode="show" size="20"></div>
								&emsp;
							</span>
						</div>
						<div class="padding">
							<% counter = 0; %> <% if(bookings != undefined){ %> <%
							bookings.forEach(function(o) { %> <% if(o.pk_ID_Fahrrad ==
							m.pk_ID) { %>
							<div class="row no-gutters">
								<div class="col-2">
									<span id="<%= o.Rentdate %><%= o.email %>date"></span> -> </span>
								</div>
								<div class="col-2">
									<span id="<%= o.Rentdate %><%= o.email %>"></span>
								</div>
								<div class="col-8">
									Gebucht von <a href="/profile/<%= o.userid %>"><%= o.email
										%></a></span>
								</div>
							</div>
							<script>
								gen_table("<%= o.Rentdate %><%= o.email %>",
										"<%= o.booked_days %>",
										"<%= o.Rentdate %>");
							</script>
							<% } %> <% }); %> <% } %>
						</div>
						<div class="row no-gutters">
							<div class="col-12 middle">
								<form method="post" action="/deleteBike">
								 <input type="hidden" name="id" value="<%= m.pk_ID %>" />
								 <input type="submit" value="L&ouml;schen" />
							</div>
							</form> 
						</div>
					</div>
				</div>
				<hr style="width: 100%; color: black; height: 1px; background-color: black;" />
				<% }); %> <% } %>
			</div>
		</div>
		<div id="bestellungen" class="tab-pane fade">
			<div class="row no-gutters">

				<% if(own_bookings!= undefined){ %> <%
				own_bookings.forEach(function(p) { %>
				<div class="col-12">
					<div class="white margin">
						<div class="padding">
							<span> <span><%= p.Rentdate %> -> Sie haben ein
									Fahrrad geliehen: <a href="/profile/<%= p.besitzerid %>"><%=
										p.besitzername %></a>
							</span> <span id="<%= p.booked_days %><%= p.email %><%= p.userid %>"><%=
									p.booked_days %></span>
								<div class="starRating" starMax="5" value="9"
									fillColor="#ffef19" emptyColor="#e8e7e3" mode="show" size="20"></div>
								<script>
									get_own_table(
											"<%= p.booked_days %><%= p.email %><%= p.userid %>",
											"<%= p.booked_days %>");
								</script>
							</span>
						</div>
					</div>
				</div>
				<hr style="width: 100%; color: black; height: 1px; background-color: black;" />
				<% }); %> <% } %>
			</div>
		</div>
	</div>
</div>

<div class="row no-gutters">
	<div class="col-5"></div>
	<div class="col-2" style="align: center">
		<div class="margin height">
			<form method="GET" action="/bike/new">
				<input type="submit" id="meineFahrrÃ¤derBtn"
					class="btn btn-secondary btn-block height"
					value="Fahrrad inserieren" />
			</form>
		</div>
	</div>
</div>


<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>



<script>
	// center: new google.maps.LatLng(<%= maps_key %>, <%= userdata.lon %>),
	function initMap() {
		var uluru = {
			lat : <%= userdata.lat %>,
			lng : <%= userdata.lon %>
		};
		var map = new google.maps.Map(document.getElementById('map'), {
			zoom : 15,
			center : uluru
		});
		var marker = new google.maps.Marker({
			position : uluru,
			map : map
		});
	}
</script>
<script
	src="https://maps.googleapis.com/maps/api/js?key=<%= maps_key %>&callback=initMap"></script>



<script type="application/javascript">
        $( document ).ready(function() {
		 if (String(window.location).indexOf("#fahrraeder") >= 0 || String(window.location).indexOf("#bestellungen") >= 0) { 
		 }else{
			window.location += "#fahrraeder";
			$('#def').click();
		 }	
        });
</script>
